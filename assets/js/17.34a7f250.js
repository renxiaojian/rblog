(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{432:function(s,n,e){"use strict";e.r(n);var a=e(21),r=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1-基础版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础版本"}},[s._v("#")]),s._v(" 1 基础版本")]),s._v(" "),e("h3",{attrs:{id:"_1-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-目标"}},[s._v("#")]),s._v(" 1.1 目标")]),s._v(" "),e("ul",[e("li",[s._v("可以创建promise对象实例")]),s._v(" "),e("li",[s._v("promise实例传入的异步方法执行成功就执行注册的成功回调函数，失败就执行注册的失败回调函数")])]),s._v(" "),e("h3",{attrs:{id:"_1-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-实现"}},[s._v("#")]),s._v(" 1.2 实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function MyPromise(fn){\n    let self = this     // 缓存当前promise实例\n    self.value = null   // 成功时的值\n    self.error = null   // 失败时的原因\n    self.onFulfuilled = null    // 成功的回调函数\n    self.onRejected = null    // 失败的回调函数\n\n    function resolve(value){\n        self.value = value\n        self.onFulfuilled(self.value)   // resolve时执行成功回调\n    }\n\n    function reject(error){\n        self.error = error\n        self.onRejected(self.error)     // reject时执行失败回调\n    }\n\n    fn(resolve,reject)\n}\n\nMyPromise.prototype.then = function(onFulfuilled,onRejected){\n    // 在这里给promis实例注册成功和失败回调\n    this.onFulfuilled = onFulfuilled\n    this.onRejected = onRejected\n}\n\nmodule.exports = MyPromise\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("h2",{attrs:{id:"_2-支持同步任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-支持同步任务"}},[s._v("#")]),s._v(" 2 支持同步任务")]),s._v(" "),e("p",[s._v("我们在使用es6 的promise时，可以传入一个异步任务，也可以传入一个同步任务，但是我们的上面基础版代码并不支持同步任务。")]),s._v(" "),e("p",[s._v("为什么呢？因为是同步任务，所以当我们的promise实例reslove时，它的then方法还没执行到，所以回调函数还没注册上，这时reslove中调用成功回调肯定会报错的。")]),s._v(" "),e("h3",{attrs:{id:"_2-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-目标"}},[s._v("#")]),s._v(" 2.1 目标")]),s._v(" "),e("ul",[e("li",[s._v("使promise支持同步方法")])]),s._v(" "),e("h3",{attrs:{id:"_2-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-实现"}},[s._v("#")]),s._v(" 2.2 实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function resolve(value) {\n    //利用setTimeout特性将具体执行放到then之后\n    setTimeout(() => {\n        self.value = value;\n        self.onFulfilled(self.value)\n    })\n}\n\nfunction reject(error) {\n    setTimeout(() => {\n        self.error = error;\n        self.onRejected(self.error)\n    })\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("实现很简单，就是在reslove和reject里面用setTimeout进行包裹，使其到then方法执行之后再去执行，这样我们就让promise支持传入同步方法")]),s._v(" "),e("h2",{attrs:{id:"_3-支持三种状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-支持三种状态"}},[s._v("#")]),s._v(" 3 支持三种状态")]),s._v(" "),e("ul",[e("li",[s._v("promise有三种状态:pending（进行中）、fulfilled（已成功）和rejected（已失败）")]),s._v(" "),e("li",[s._v("promise一旦状态改变，就不会再变")]),s._v(" "),e("li",[s._v("如果改变已经发生了，你再对promise对象添加回调函数，也会立即得到这个结果")])]),s._v(" "),e("h3",{attrs:{id:"_3-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-目标"}},[s._v("#")]),s._v(" 3.1 目标")]),s._v(" "),e("ol",[e("li",[s._v("实现promise的三种状态")]),s._v(" "),e("li",[s._v("实现promise对象的状态改变。从pending->fulfilled和从pending->rejected")]),s._v(" "),e("li",[s._v("实现一旦promise状态改变，再对promise对象添加回调函数，也会立即得到这个结果")])]),s._v(" "),e("h3",{attrs:{id:"_3-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-实现"}},[s._v("#")]),s._v(" 3.2 实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 定义三种状态\nconst PENDING = 'pending'\nconst FULFILLED = 'fulfilled'\nconst REJECTED = 'rejected'\nfunction MyPromise(fn){\n    let self = this     // 缓存当前promise实例\n    self.value = null   // 成功时的值\n    self.error = null   // 失败时的原因\n    self.status = PENDING\n    self.onFulfuilled = null    // 成功的回调函数\n    self.onRejected = null    // 失败的回调函数\n\n    function resolve(value){\n         // 如果状态是pending才去修改状态为fulfilled并执行成功逻辑\n        if(self.status === PENDING){\n            // 利用setTimeout特性将具体执行放到then之后\n            setTimeout(()=>{\n                self.status = FULFILLED\n                self.value = value\n                self.onFulfuilled(self.value)   // resolve时执行成功回调\n            })\n        }\n    }\n\n    function reject(error){\n        // 如果状态是pending才去修改状态为rejected并执行失败逻辑\n        if(self.status === REJECTED){\n            setTimeout(()=>{\n                self.status = REJECTED\n                self.error = error\n                self.onRejected(self.error)     // reject时执行失败回调\n            })\n        }\n    }\n\n    fn(resolve,reject)\n}\n\nMyPromise.prototype.then = function(onFulfuilled,onRejected){\n    if (this.status === PENDING){\n        // 在这里给promis实例注册成功和失败回调\n        this.onFulfuilled = onFulfuilled\n        this.onRejected = onRejected\n    } else if(this.status === FULFILLED){\n        //如果状态是fulfilled，直接执行成功回调，并将成功值传入\n        onFulfilled(this.value)\n    } else {\n        //如果状态是rejected，直接执行失败回调，并将失败原因传入\n        onRejected(this.error)\n    }\n}\n\nmodule.exports = MyPromise\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br")])]),e("h2",{attrs:{id:"_4-支持链式操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-支持链式操作"}},[s._v("#")]),s._v(" 4 支持链式操作")]),s._v(" "),e("p",[e("code",[s._v("promise.then(f1).then(f2).then(f3)")])]),s._v(" "),e("h3",{attrs:{id:"_4-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-目标"}},[s._v("#")]),s._v(" 4.1 目标")]),s._v(" "),e("ul",[e("li",[s._v("使promise支持链式操作")])]),s._v(" "),e("h3",{attrs:{id:"_4-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-实现"}},[s._v("#")]),s._v(" 4.2 实现")]),s._v(" "),e("p",[s._v("想支持链式操作，首先存储回调时要改为使用数组")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("self.onFulfilledCallbacks = [];\nself.onRejectedCallbacks = [];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行回调时，也要改成遍历回调数组执行回调函数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("self.onFulfilledCallbacks.forEach((callback) => callback(self.value));\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("最后，then方法也要改一下,只需要在最后一行加一个return this即可，这其实和jQuery链式操作的原理一致，每次调用完方法都返回自身实例，后面的方法也是实例的方法，所以可以继续执行。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("MyPromise.prototype.then = function(onFulfilled, onRejected) {\n    if (this.status === PENDING) {\n        this.onFulfilledCallbacks.push(onFulfilled);\n        this.onRejectedCallbacks.push(onRejected);\n    } else if (this.status === FULFILLED) {\n        onFulfilled(this.value)\n    } else {\n        onRejected(this.error)\n    }\n    return this;\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"_5-支持串行异步任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-支持串行异步任务"}},[s._v("#")]),s._v(" 5 支持串行异步任务")]),s._v(" "),e("h3",{attrs:{id:"_5-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-目标"}},[s._v("#")]),s._v(" 5.1 目标")]),s._v(" "),e("ul",[e("li",[s._v("使promise支持串行异步操作")])]),s._v(" "),e("h3",{attrs:{id:"_5-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-实现"}},[s._v("#")]),s._v(" 5.2 实现")]),s._v(" "),e("p",[s._v("要想实现异步操作串行，我们不能将回调函数都注册在初始promise的onFulfilledCallbacks里面，而要将每个回调函数注册在对应的异步操作promise的onFulfilledCallbacks里面")]),s._v(" "),e("p",[s._v("如何既能保持这种链式写法的同时又能使异步操作衔接执行呢？我们其实让then方法最后不再返回自身实例，而是返回一个新的promise即可，我们可以叫它bridgePromise，它最大的作用就是衔接后续操作")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 定义三种状态\nconst PENDING = 'pending'\nconst FULFILLED = 'fulfilled'\nconst REJECTED = 'rejected'\nfunction MyPromise(fn) {\n    let self = this     // 缓存当前promise实例\n    self.value = null   // 成功时的值\n    self.error = null   // 失败时的原因\n    self.status = PENDING\n    self.onFulfilledCallbacks = []    // 成功的回调函数\n    self.onRejectedCallbacks = []    // 失败的回调函数\n\n    function resolve(value) {\n        // 如果状态是pending才去修改状态为fulfilled并执行成功逻辑\n        if (self.status === PENDING) {\n            // 利用setTimeout特性将具体执行放到then之后\n            setTimeout(() => {\n                self.status = FULFILLED\n                self.value = value\n                self.onFulfilledCallbacks.forEach((callback) => callback(self.value))   // resolve时执行成功回调\n            })\n        }\n    }\n\n    function reject(error) {\n        // 如果状态是pending才去修改状态为rejected并执行失败逻辑\n        if (self.status === REJECTED) {\n            setTimeout(() => {\n                self.status = REJECTED\n                self.error = error\n                self.onRejectedCallbacks.forEach((callback) => callback(self.value))     // reject时执行失败回调\n            })\n        }\n    }\n\n    fn(resolve, reject)\n}\n//用来解析回调函数的返回值x，x可能是普通值也可能是个promise对象\nfunction resolvePromise(bridgePromise, x, resolve, reject) {\n    //如果x是一个promise\n    if (x instanceof MyPromise) {\n        //如果这个promise是pending状态，就在它的then方法里继续执行resolvePromise解析它的结果，直到返回值不是一个pending状态的promise为止\n        if (x.status === PENDING) {\n            x.then(y => {\n                resolvePromise(bridgePromise, y, resolve, reject);\n            }, error => {\n                reject(error);\n            });\n        } else {\n            x.then(resolve, reject);\n        }\n        //如果x是一个普通值，就让bridgePromise的状态fulfilled，并把这个值传递下去\n    } else {\n        resolve(x);\n    }\n}\n\nMyPromise.prototype.then = function (onFulfilled, onRejected) {\n    const self = this;\n    let bridgePromise;\n    //防止使用者不传成功或失败回调函数，所以成功失败回调都给了默认回调函数\n    onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : value => value;\n    onRejected = typeof onRejected === \"function\" ? onRejected : error => { throw error };\n\n    if (self.status === FULFILLED) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            setTimeout(() => {\n                try {\n                    let x = onFulfilled(self.value);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })\n    }\n    if (self.status === REJECTED) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            setTimeout(() => {\n                try {\n                    let x = onRejected(self.error);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        });\n    }\n    if (self.status === PENDING) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            self.onFulfilledCallbacks.push((value) => {\n                try {\n                    let x = onFulfilled(value);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n            self.onRejectedCallbacks.push((error) => {\n                try {\n                    let x = onRejected(error);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        });\n    }\n}\n//catch方法其实是个语法糖，就是只传onRejected不传onFulfilled的then方法\nMyPromise.prototype.catch = function (onRejected) {\n    return this.then(null, onRejected);\n}\nmodule.exports = MyPromise\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br")])]),e("h2",{attrs:{id:"_6-达到promises-a-规范"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-达到promises-a-规范"}},[s._v("#")]),s._v(" 6 达到Promises/A+规范")]),s._v(" "),e("h3",{attrs:{id:"_6-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-目标"}},[s._v("#")]),s._v(" 6.1 目标")]),s._v(" "),e("ul",[e("li",[s._v("使promise达到Promises/A+规范，通过promises-aplus-tests的完整测试")])]),s._v(" "),e("h3",{attrs:{id:"_6-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-实现"}},[s._v("#")]),s._v(" 6.2 实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('const PENDING = "pending";\nconst FULFILLED = "fulfilled";\nconst REJECTED = "rejected";\n\nfunction MyPromise(fn) {\n    const self = this;\n    self.value = null;\n    self.error = null;\n    self.status = PENDING;\n    self.onFulfilledCallbacks = [];\n    self.onRejectedCallbacks = [];\n\n    function resolve(value) {\n        if (value instanceof MyPromise) {\n            return value.then(resolve, reject);\n        }\n        if (self.status === PENDING) {\n            setTimeout(() => {\n                self.status = FULFILLED;\n                self.value = value;\n                self.onFulfilledCallbacks.forEach((callback) => callback(self.value));\n            }, 0)\n        }\n    }\n\n    function reject(error) {\n        if (self.status === PENDING) {\n            setTimeout(function() {\n                self.status = REJECTED;\n                self.error = error;\n                self.onRejectedCallbacks.forEach((callback) => callback(self.error));\n            }, 0)\n        }\n    }\n    try {\n        fn(resolve, reject);\n    } catch (e) {\n        reject(e);\n    }\n}\n\nfunction resolvePromise(bridgepromise, x, resolve, reject) {\n    //2.3.1规范，避免循环引用\n    if (bridgepromise === x) {\n        return reject(new TypeError(\'Circular reference\'));\n    }\n    let called = false;\n    //这个判断分支其实已经可以删除，用下面那个分支代替，因为promise也是一个thenable对象\n    if (x instanceof MyPromise) {\n        if (x.status === PENDING) {\n            x.then(y => {\n                resolvePromise(bridgepromise, y, resolve, reject);\n            }, error => {\n                reject(error);\n            });\n        } else {\n            x.then(resolve, reject);\n        }\n        // 2.3.3规范，如果 x 为对象或者函数\n    } else if (x != null && ((typeof x === \'object\') || (typeof x === \'function\'))) {\n        try {\n            // 是否是thenable对象（具有then方法的对象/函数）\n            //2.3.3.1 将 then 赋为 x.then\n            let then = x.then;\n            if (typeof then === \'function\') {\n            //2.3.3.3 如果 then 是一个函数，以x为this调用then函数，且第一个参数是resolvePromise，第二个参数是rejectPromise\n                then.call(x, y => {\n                    if (called) return;\n                    called = true;\n                    resolvePromise(bridgepromise, y, resolve, reject);\n                }, error => {\n                    if (called) return;\n                    called = true;\n                    reject(error);\n                })\n            } else {\n            //2.3.3.4 如果 then不是一个函数，则 以x为值fulfill promise。\n                resolve(x);\n            }\n        } catch (e) {\n        //2.3.3.2 如果在取x.then值时抛出了异常，则以这个异常做为原因将promise拒绝。\n            if (called) return;\n            called = true;\n            reject(e);\n        }\n    } else {\n        resolve(x);\n    }\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected) {\n    const self = this;\n    let bridgePromise;\n    onFulfilled = typeof onFulfilled === "function" ? onFulfilled : value => value;\n    onRejected = typeof onRejected === "function" ? onRejected : error => { throw error };\n    if (self.status === FULFILLED) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            setTimeout(() => {\n                try {\n                    let x = onFulfilled(self.value);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            }, 0);\n        })\n    }\n    if (self.status === REJECTED) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            setTimeout(() => {\n                try {\n                    let x = onRejected(self.error);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            }, 0);\n        });\n    }\n    if (self.status === PENDING) {\n        return bridgePromise = new MyPromise((resolve, reject) => {\n            self.onFulfilledCallbacks.push((value) => {\n                try {\n                    let x = onFulfilled(value);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n            self.onRejectedCallbacks.push((error) => {\n                try {\n                    let x = onRejected(error);\n                    resolvePromise(bridgePromise, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        });\n    }\n}\nMyPromise.prototype.catch = function(onRejected) {\n    return this.then(null, onRejected);\n}\n// 执行测试用例需要用到的代码\nMyPromise.deferred = function() {\n    let defer = {};\n    defer.promise = new MyPromise((resolve, reject) => {\n        defer.resolve = resolve;\n        defer.reject = reject;\n    });\n    return defer;\n}\ntry {\n    module.exports = MyPromise\n} catch (e) {}\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br"),e("span",{staticClass:"line-number"},[s._v("140")]),e("br"),e("span",{staticClass:"line-number"},[s._v("141")]),e("br"),e("span",{staticClass:"line-number"},[s._v("142")]),e("br"),e("span",{staticClass:"line-number"},[s._v("143")]),e("br"),e("span",{staticClass:"line-number"},[s._v("144")]),e("br"),e("span",{staticClass:"line-number"},[s._v("145")]),e("br"),e("span",{staticClass:"line-number"},[s._v("146")]),e("br"),e("span",{staticClass:"line-number"},[s._v("147")]),e("br"),e("span",{staticClass:"line-number"},[s._v("148")]),e("br"),e("span",{staticClass:"line-number"},[s._v("149")]),e("br"),e("span",{staticClass:"line-number"},[s._v("150")]),e("br"),e("span",{staticClass:"line-number"},[s._v("151")]),e("br"),e("span",{staticClass:"line-number"},[s._v("152")]),e("br"),e("span",{staticClass:"line-number"},[s._v("153")]),e("br"),e("span",{staticClass:"line-number"},[s._v("154")]),e("br"),e("span",{staticClass:"line-number"},[s._v("155")]),e("br"),e("span",{staticClass:"line-number"},[s._v("156")]),e("br")])]),e("h2",{attrs:{id:"_7-实现-promise-的all-race-resolve-reject方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-实现-promise-的all-race-resolve-reject方法"}},[s._v("#")]),s._v(" 7 实现 promise 的all，race，resolve，reject方法")]),s._v(" "),e("h3",{attrs:{id:"_7-1-目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-目标"}},[s._v("#")]),s._v(" 7.1 目标")]),s._v(" "),e("p",[s._v("实现es6 promise的all，race，resolve，reject方法")]),s._v(" "),e("h3",{attrs:{id:"_7-2-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-实现"}},[s._v("#")]),s._v(" 7.2 实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("MyPromise.all = function(promises) {\n    return new MyPromise(function(resolve, reject) {\n        let result = [];\n        let count = 0;\n        for (let i = 0; i < promises.length; i++) {\n            promises[i].then(function(data) {\n                result[i] = data;\n                if (++count == promises.length) {\n                    resolve(result);\n                }\n            }, function(error) {\n                reject(error);\n            });\n        }\n    });\n}\n\nMyPromise.race = function(promises) {\n    return new MyPromise(function(resolve, reject) {\n        for (let i = 0; i < promises.length; i++) {\n            promises[i].then(function(data) {\n                resolve(data);\n            }, function(error) {\n                reject(error);\n            });\n        }\n    });\n}\n\nMyPromise.resolve = function(value) {\n    return new MyPromise(resolve => {\n        resolve(value);\n    });\n}\n\nMyPromise.reject = function(error) {\n    return new MyPromise((resolve, reject) => {\n        reject(error);\n    });\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("参考文章")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6844903617619558408",target:"_blank",rel:"noopener noreferrer"}},[s._v("一起学习造轮子（一）：从零开始写一个符合Promises/A+规范的promise"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=r.exports}}]);